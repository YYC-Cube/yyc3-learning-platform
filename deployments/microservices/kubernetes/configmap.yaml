# ============================================================================
# YYC³ AI Platform - Kubernetes ConfigMap Configuration
# ============================================================================

apiVersion: v1
kind: ConfigMap
metadata:
  name: yyc3-config
  namespace: yyc3-platform
  labels:
    app: yyc3-platform
    component: configuration
data:
  # Database Configuration
  mongodb.url: "mongodb://mongodb:27017/yyc3-platform"
  postgres.url: "postgresql://postgres:password@postgres:5432/yyc3-platform"
  redis.url: "redis://redis:6379"
  neo4j.url: "bolt://neo4j:7687"
  influxdb.url: "http://influxdb:8086"

  # Service URLs
  autonomous-engine.url: "http://autonomous-engine:3000"
  model-adapter.url: "http://model-adapter:3000"
  learning-system.url: "http://learning-system:3000"
  five-dimensional-management.url: "http://five-dimensional-management:3000"
  enterprise-ai-widget.url: "http://enterprise-ai-widget:3000"

  # Message Queue Configuration
  kafka.brokers: "kafka:9092"
  zookeeper.url: "zookeeper:2181"

  # Monitoring Configuration
  consul.url: "consul://consul:8500"
  prometheus.url: "http://prometheus:9090"
  grafana.url: "http://grafana:3000"
  jaeger.url: "http://jaeger:14268/api/traces"

  # AI/ML Configuration
  tensorflow-serving.url: "http://tensorflow-serving:8501"
  ml.models.path: "/models"

  # Application Configuration
  node.env: "production"
  log.level: "info"
  cors.origin: "*"
  rate.limit.window: "15m"
  rate.limit.max: "100"

  # Security Configuration
  jwt.secret: "yyc3-jwt-secret-change-in-production"
  session.secret: "yyc3-session-secret-change-in-production"
  encryption.key: "yyc3-encryption-key-change-in-production"

  # Business Configuration
  organization.name: "YYC³ AI Platform"
  organization.domain: "yyc3.0379.email"
  support.email: "support@yyc3.0379.email"
  max.users: "10000"
  max.requests.minute: "1000"
  session.timeout: "24h"

---
# Service Discovery Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: service-discovery
  namespace: yyc3-platform
  labels:
    app: yyc3-platform
    component: service-discovery
data:
  consul.json: |
    {
      "datacenter": "dc1",
      "data_dir": "/consul/data",
      "log_level": "INFO",
      "server": true,
      "bootstrap_expect": 1,
      "ui_config": {
        "enabled": true
      },
      "connect": {
        "enabled": true
      }
    }

---
# Prometheus Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-config
  namespace: yyc3-platform
  labels:
    app: yyc3-platform
    component: monitoring
data:
  prometheus.yml: |
    global:
      scrape_interval: 15s
      evaluation_interval: 15s

    rule_files:
      - "/etc/prometheus/rules/*.yml"

    scrape_configs:
      - job_name: 'kubernetes-apiservers'
        kubernetes_sd_configs:
        - role: endpoints
        scheme: https
        tls_config:
          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
        bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
        relabel_configs:
        - source_labels: [__meta_kubernetes_namespace, __meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]
          action: keep
          regex: default;kubernetes;https

      - job_name: 'kubernetes-nodes'
        kubernetes_sd_configs:
        - role: node
        scheme: https
        tls_config:
          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
        bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
        relabel_configs:
        - action: labelmap
          regex: __meta_kubernetes_node_label_(.+)

      - job_name: 'kubernetes-pods'
        kubernetes_sd_configs:
        - role: pod
        relabel_configs:
        - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
          action: keep
          regex: true
        - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
          action: replace
          target_label: __metrics_path__
          regex: (.+)
        - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]
          action: replace
          regex: ([^:]+)(?::\d+)?;(\d+)
          replacement: $1:$2
          target_label: __address__
        - action: labelmap
          regex: __meta_kubernetes_pod_label_(.+)
        - source_labels: [__meta_kubernetes_namespace]
          action: replace
          target_label: kubernetes_namespace
        - source_labels: [__meta_kubernetes_pod_name]
          action: replace
          target_label: kubernetes_pod_name

      - job_name: 'yyc3-services'
        kubernetes_sd_configs:
        - role: endpoints
          namespaces:
            names:
            - yyc3-platform
        relabel_configs:
        - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape]
          action: keep
          regex: true
        - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_path]
          action: replace
          target_label: __metrics_path__
          regex: (.+)
        - source_labels: [__address__, __meta_kubernetes_service_annotation_prometheus_io_port]
          action: replace
          regex: ([^:]+)(?::\d+)?;(\d+)
          replacement: $1:$2
          target_label: __address__
        - action: labelmap
          regex: __meta_kubernetes_service_label_(.+)
        - source_labels: [__meta_kubernetes_namespace]
          action: replace
          target_label: kubernetes_namespace
        - source_labels: [__meta_kubernetes_service_name]
          action: replace
          target_label: kubernetes_name

---
# Grafana Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-config
  namespace: yyc3-platform
  labels:
    app: yyc3-platform
    component: monitoring
data:
  grafana.ini: |
    [server]
    http_port = 3000
    domain = grafana.yyc3.0379.email

    [database]
    type = sqlite3
    path = /var/lib/grafana/grafana.db

    [security]
    admin_user = admin
    admin_password = grafana-password

    [users]
    allow_sign_up = false

    [auth.anonymous]
    enabled = true

    [log]
    level = info

    [metrics]
    enabled = true