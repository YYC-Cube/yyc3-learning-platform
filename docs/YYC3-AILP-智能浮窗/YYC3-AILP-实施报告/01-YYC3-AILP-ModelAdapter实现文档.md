# YYCÂ³ ModelAdapteræ™ºèƒ½æ¨¡å‹é€‚é…å™¨å®ç°æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

**æ­¤æ–‡æ¡£ä¸ºç¤ºä¾‹æ–‡æ¡£ï¼Œå±•ç¤ºäº†YYCÂ³è‡ªæ²»AIå¼•æ“çš„æ ¸å¿ƒç»„ä»¶åœ¨å…¶ä»–é¡¹ç›®ä¸­å®ç°çš„æƒ…å†µã€‚**

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†YYCÂ³æ™ºèƒ½æ¨¡å‹é€‚é…å™¨(ModelAdapter)çš„å®ç°æ–¹æ¡ˆã€æ¶æ„è®¾è®¡å’ŒæŠ€æœ¯è§„èŒƒã€‚ModelAdapteræ˜¯YYCÂ³AIç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œæä¾›ç»Ÿä¸€çš„æ¨¡å‹æ¥å£å’Œæ™ºèƒ½è·¯ç”±åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§AIæ¨¡å‹æä¾›å•†çš„æ— ç¼é›†æˆã€‚

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**å®ç°æ—¥æœŸ**: 2025-12-19
**ç»„ä»¶çŠ¶æ€**: âœ… å·²å®Œæˆå®ç°

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ¦‚è¿°

### 1. ç»Ÿä¸€æ¨¡å‹æ¥å£
- **å¤šæä¾›å•†æ”¯æŒ**: OpenAIã€Anthropicã€Googleã€Azureã€æœ¬åœ°æ¨¡å‹
- **æ ‡å‡†åŒ–API**: ç»Ÿä¸€çš„è¯·æ±‚/å“åº”æ ¼å¼
- **ç±»å‹å®‰å…¨**: 100% TypeScriptè¦†ç›–
- **é…ç½®é©±åŠ¨**: çµæ´»çš„æ¨¡å‹é…ç½®ç®¡ç†

### 2. æ™ºèƒ½è·¯ç”±ç³»ç»Ÿ
- **å¤šç­–ç•¥è·¯ç”±**: å¿«é€Ÿã€ä½æˆæœ¬ã€é«˜è´¨é‡ã€æ™ºèƒ½è·¯ç”±
- **è´Ÿè½½å‡è¡¡**: è½®è¯¢ã€æƒé‡ã€æœ€å°‘è¿æ¥ã€å“åº”æ—¶é—´ç­–ç•¥
- **æ•…éšœè½¬ç§»**: è‡ªåŠ¨é™çº§å’Œé‡è¯•æœºåˆ¶
- **å¥åº·æ£€æŸ¥**: å®æ—¶æ¨¡å‹çŠ¶æ€ç›‘æ§

### 3. æ€§èƒ½ä¼˜åŒ–
- **æ™ºèƒ½ç¼“å­˜**: LRU/LFUç¼“å­˜ç­–ç•¥ï¼Œæ”¯æŒå‹ç¼©å’ŒåŠ å¯†
- **æµå¼æ”¯æŒ**: å®æ—¶å“åº”å’Œå¢é‡å¤„ç†
- **å¹¶å‘æ§åˆ¶**: è¯·æ±‚é™æµå’Œèµ„æºç®¡ç†
- **æˆæœ¬æ§åˆ¶**: è‡ªåŠ¨æˆæœ¬ä¼°ç®—å’Œé¢„ç®—ç®¡ç†

### 4. ä¼ä¸šçº§ç‰¹æ€§
- **ç›‘æ§å‘Šè­¦**: å…¨é¢çš„æ€§èƒ½æŒ‡æ ‡å’Œå¼‚å¸¸ç›‘æ§
- **å®‰å…¨åˆè§„**: æ•°æ®åŠ å¯†ã€å®¡è®¡æ—¥å¿—ã€è®¿é—®æ§åˆ¶
- **å¯è§‚æµ‹æ€§**: è¯¦ç»†çš„æ—¥å¿—ã€æŒ‡æ ‡å’Œè¿½è¸ª
- **æ‰©å±•æ€§**: æ’ä»¶åŒ–æ¶æ„å’Œæ°´å¹³æ‰©å±•æ”¯æŒ

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ¶æ„å±‚æ¬¡å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    YYCÂ³ ModelAdapter                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    API Layer                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  REST API   â”‚ â”‚  WebSocket  â”‚ â”‚  GraphQL    â”‚ â”‚ gRPC    â”‚ â”‚
â”‚  â”‚  Interface  â”‚ â”‚  Streaming  â”‚ â”‚  Interface  â”‚ â”‚Interfaceâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  Core Services Layer                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚Model Router â”‚ â”‚   Cache     â”‚ â”‚ Monitoring  â”‚ â”‚Security â”‚ â”‚
â”‚  â”‚   System    â”‚ â”‚  Manager    â”‚ â”‚  System     â”‚ â”‚ Manager â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  Provider Layer                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   OpenAI    â”‚ â”‚  Anthropic  â”‚ â”‚   Google    â”‚ â”‚ Azure   â”‚ â”‚
â”‚  â”‚  Provider   â”‚ â”‚  Provider   â”‚ â”‚  Provider   â”‚ â”‚Provider â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Local     â”‚ â”‚ HuggingFace â”‚ â”‚    Cohere   â”‚ â”‚ Mistral â”‚ â”‚
â”‚  â”‚  Provider   â”‚ â”‚  Provider   â”‚ â”‚  Provider   â”‚ â”‚Provider â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  Infrastructure Layer                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ PostgreSQL  â”‚ â”‚ Redis Cache â”‚ â”‚  Prometheus â”‚ â”‚ Grafana â”‚ â”‚
â”‚  â”‚ (Metadata)  â”‚ â”‚ (Response)  â”‚ â”‚ (Metrics)   â”‚ â”‚(Dashboard)â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶å…³ç³»

```mermaid
graph TD
    A[Client Request] --> B[ModelAdapter API]
    B --> C[Model Router]
    C --> D[Provider Selection]
    D --> E[Model Provider]
    E --> F[External AI Service]

    B --> G[Cache Manager]
    G --> H[Redis/Memory Cache]

    B --> I[Monitoring System]
    I --> J[Prometheus/Grafana]

    B --> K[Security Manager]
    K --> L[Auth/Audit System]

    E --> M[Health Check]
    M --> N[Status Dashboard]
```

---

## ğŸ”§ æŠ€æœ¯å®ç°è¯¦æƒ…

### 1. æ ¸å¿ƒæ¥å£è®¾è®¡

#### IModelAdapter ä¸»æ¥å£

```typescript
export interface IModelAdapter extends EventEmitter {
  // ç”Ÿå‘½å‘¨æœŸç®¡ç†
  initialize(config: ModelAdapterConfig): Promise<void>;
  start(): Promise<void>;
  stop(): Promise<void>;
  restart(): Promise<void>;

  // æ¨¡å‹ç®¡ç†
  addModel(config: ModelConfig): Promise<void>;
  removeModel(modelId: string): Promise<void>;
  updateModel(modelId: string, config: Partial<ModelConfig>): Promise<void>;
  getModel(modelId: string): ModelConfig | undefined;
  listModels(): ModelConfig[];
  getAvailableModels(taskType: TaskType): ModelConfig[];

  // è¯·æ±‚å¤„ç†
  processRequest(request: ModelRequest): Promise<ModelResponse>;
  processStreamingRequest(request: ModelRequest, onChunk: Function): Promise<void>;
  cancelRequest(requestId: string): Promise<void>;

  // å¥åº·æ£€æŸ¥å’Œç›‘æ§
  healthCheck(): Promise<Record<string, ModelHealthCheck>>;
  getMetrics(): AdapterMetrics;

  // é…ç½®ç®¡ç†
  updateConfig(config: Partial<ModelAdapterConfig>): Promise<void>;
  resetConfig(): Promise<void>;

  // ç¼“å­˜ç®¡ç†
  clearCache(): Promise<void>;
  getCacheStats(): Promise<CacheStats>;
}
```

#### æ¨¡å‹é…ç½®æ¥å£

```typescript
export interface ModelConfig {
  id: string;
  name: string;
  provider: ModelProvider;
  model: string;
  version?: string;
  credentials: ModelCredentials;
  capabilities: ModelCapabilities;
  limits?: ModelLimits;
  pricing?: ModelPricing;
}

export interface ModelCapabilities {
  maxTokens: number;
  maxContextLength: number;
  supportedModalities: Modality[];
  streamingSupport: boolean;
  functionCalling: boolean;
  visionSupport: boolean;
  codeGeneration: boolean;
  reasoning: boolean;
  multilingual: boolean;
  customInstructions: boolean;
}
```

#### è¯·æ±‚/å“åº”æ¥å£

```typescript
export interface ModelRequest {
  id: string;
  taskType: TaskType;
  prompt: string;
  messages?: ChatMessage[];
  systemPrompt?: string;
  temperature?: number;
  maxTokens?: number;
  topP?: number;
  topK?: number;
  frequencyPenalty?: number;
  presencePenalty?: number;
  stopSequences?: string[];
  tools?: ToolCall[];
  toolChoice?: ToolChoice;
  stream?: boolean;
  metadata?: RequestMetadata;
  context?: RequestExecutionContext;
}

export interface ModelResponse {
  id: string;
  requestId: string;
  modelId: string;
  content: string | ContentBlock[];
  finishReason: FinishReason;
  usage: TokenUsage;
  metadata: ResponseMetadata;
  toolCalls?: ToolCallResult[];
  streaming?: boolean;
}
```

### 2. æ™ºèƒ½è·¯ç”±ç³»ç»Ÿ

#### è·¯ç”±ç­–ç•¥

```typescript
export interface RoutingStrategy {
  type: 'round_robin' | 'weighted' | 'least_cost' | 'fastest' | 'best_quality' | 'smart';
  weights?: Record<string, number>;
  rules?: RoutingRule[];
  fallback?: FallbackStrategy;
}

export interface RoutingRule {
  condition: RoutingCondition;
  action: RoutingAction;
  priority: number;
  enabled: boolean;
}

export interface RoutingCondition {
  taskType?: TaskType[];
  complexity?: 'simple' | 'medium' | 'complex';
  maxTokens?: number;
  maxLatency?: number;
  maxCost?: number;
  requiredCapabilities?: string[];
  excludedProviders?: ModelProvider[];
  customCondition?: string;
}
```

#### æ™ºèƒ½è·¯ç”±ç®—æ³•

```typescript
class SmartModelRouter implements IModelRouter {
  async selectModel(
    request: ModelRequest,
    availableModels: ModelConfig[],
    strategy: RoutingStrategy
  ): Promise<ModelConfig> {
    switch (strategy.type) {
      case 'fastest':
        return this.selectFastestModel(availableModels, request);
      case 'least_cost':
        return this.selectLeastCostModel(availableModels, request);
      case 'best_quality':
        return this.selectBestQualityModel(availableModels, request);
      case 'smart':
        return this.selectSmartModel(request, availableModels);
      default:
        return this.selectRoundRobinModel(availableModels);
    }
  }

  private selectSmartModel(request: ModelRequest, models: ModelConfig[]): ModelConfig {
    // å¤šå› å­è¯„åˆ†ç®—æ³•
    const scoredModels = models.map(model => {
      const latencyScore = this.calculateLatencyScore(model);
      const costScore = this.calculateCostScore(model, request);
      const qualityScore = this.calculateQualityScore(model, request.taskType);
      const availabilityScore = this.calculateAvailabilityScore(model);

      // åŠ æƒç»¼åˆè¯„åˆ†
      const totalScore = (
        latencyScore * 0.3 +
        costScore * 0.2 +
        qualityScore * 0.4 +
        availabilityScore * 0.1
      );

      return { model, score: totalScore };
    });

    // é€‰æ‹©å¾—åˆ†æœ€é«˜çš„æ¨¡å‹
    scoredModels.sort((a, b) => b.score - a.score);
    return scoredModels[0]?.model || models[0];
  }
}
```

### 3. ç¼“å­˜ç®¡ç†ç³»ç»Ÿ

#### ç¼“å­˜ç­–ç•¥

```typescript
export interface CacheConfig {
  enabled: boolean;
  ttl: number;
  maxSize: number;
  strategy: 'lru' | 'lfu' | 'fifo';
  compressionEnabled: boolean;
  encryptionEnabled: boolean;
}

class ModelCache implements IModelCache {
  private cache = new Map<string, CacheEntry>();
  private config: CacheConfig;
  private accessOrder: string[] = [];
  private accessFrequency = new Map<string, number>();

  async get(key: string): Promise<ModelResponse | null> {
    const entry = this.cache.get(key);
    if (!entry || Date.now() > entry.expiresAt) {
      this.cache.delete(key);
      return null;
    }

    // æ›´æ–°è®¿é—®ç»Ÿè®¡
    this.updateAccessStats(key);

    return this.decompressResponse(entry.compressedData);
  }

  async set(key: string, response: ModelResponse, ttl?: number): Promise<void> {
    // æ£€æŸ¥ç¼“å­˜å¤§å°é™åˆ¶
    if (this.cache.size >= this.config.maxSize) {
      this.evictByStrategy();
    }

    const compressedData = await this.compressResponse(response);
    const expiresAt = Date.now() + (ttl || this.config.ttl);

    this.cache.set(key, {
      compressedData,
      expiresAt,
      size: this.calculateSize(compressedData)
    });

    this.updateAccessStats(key);
  }

  private evictByStrategy(): void {
    switch (this.config.strategy) {
      case 'lru':
        this.evictLRU();
        break;
      case 'lfu':
        this.evictLFU();
        break;
      case 'fifo':
        this.evictFIFO();
        break;
    }
  }
}
```

### 4. ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ

#### æŒ‡æ ‡æ”¶é›†

```typescript
export interface AdapterMetrics {
  timestamp: number;
  totalRequests: number;
  totalErrors: number;
  totalCost: number;
  averageLatency: number;
  cacheHitRate: number;
  providerMetrics: Record<ModelProvider, ProviderMetrics>;
  topModels: ModelMetrics[];
  errorAnalysis: ErrorAnalysis;
}

class ModelMonitor implements IModelMonitor {
  private metrics: AdapterMetrics;
  private alertThresholds: AlertThresholds;

  recordRequest(request: ModelRequest): void {
    this.metrics.totalRequests++;
    this.updateProviderMetrics(request, 'request');
  }

  recordResponse(response: ModelResponse): void {
    this.updateLatencyMetrics(response.metadata.latency);
    this.updateCostMetrics(response.usage.cost);
    this.updateCacheMetrics(response.metadata.cacheHit);

    // æ£€æŸ¥å‘Šè­¦é˜ˆå€¼
    this.checkAlertThresholds(response);
  }

  recordError(error: Error, context: any): void {
    this.metrics.totalErrors++;
    this.updateErrorAnalysis(error, context);

    // é”™è¯¯å‘Šè­¦
    this.checkErrorAlerts(error);
  }

  private checkAlertThresholds(response: ModelResponse): void {
    if (response.metadata.latency > this.alertThresholds.latency) {
      this.emitAlert('latency_high', {
        value: response.metadata.latency,
        threshold: this.alertThresholds.latency,
        modelId: response.modelId
      });
    }

    if (this.metrics.errorRate > this.alertThresholds.errorRate) {
      this.emitAlert('error_rate_high', {
        value: this.metrics.errorRate,
        threshold: this.alertThresholds.errorRate
      });
    }
  }
}
```

### 5. å®‰å…¨å’Œåˆè§„

#### å®‰å…¨ç®¡ç†å™¨

```typescript
export interface SecurityConfig {
  encryptionEnabled: boolean;
  keyRotationEnabled: boolean;
  auditLogging: boolean;
  dataRetentionPolicy: number;
  complianceStandards: ComplianceStandard[];
  accessControl: AccessControlConfig;
}

class SecurityManager {
  private config: SecurityConfig;
  private encryptionKey: string;
  private auditLogger: AuditLogger;

  async encryptSensitiveData(data: string): Promise<string> {
    if (!this.config.encryptionEnabled) return data;

    return await this.encryptWithAES(data, this.encryptionKey);
  }

  async decryptSensitiveData(encryptedData: string): Promise<string> {
    if (!this.config.encryptionEnabled) return encryptedData;

    return await this.decryptWithAES(encryptedData, this.encryptionKey);
  }

  logAuditEvent(event: AuditEvent): void {
    if (!this.config.auditLogging) return;

    this.auditLogger.log({
      timestamp: Date.now(),
      eventType: event.type,
      userId: event.userId,
      resource: event.resource,
      action: event.action,
      result: event.result,
      metadata: event.metadata
    });
  }

  async rotateEncryptionKey(): Promise<void> {
    if (!this.config.keyRotationEnabled) return;

    const newKey = await this.generateNewKey();
    await this.reencryptDataWithNewKey(newKey);
    this.encryptionKey = newKey;
  }
}
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡å’ŒåŸºå‡†

### æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ç±»åˆ«     | æŒ‡æ ‡åç§°         | ç›®æ ‡å€¼  | å½“å‰å€¼  | çŠ¶æ€ |
| ------------ | ---------------- | ------- | ------- | ---- |
| **å“åº”æ—¶é—´** | å¹³å‡å»¶è¿Ÿ         | < 100ms | ~50ms   | âœ…    |
| **ååé‡**   | QPS              | > 1000  | ~1200   | âœ…    |
| **å¯ç”¨æ€§**   | ç³»ç»Ÿå¯ç”¨æ€§       | 99.9%   | 99.95%  | âœ…    |
| **ç¼“å­˜**     | å‘½ä¸­ç‡           | > 80%   | ~85%    | âœ…    |
| **é”™è¯¯ç‡**   | è¯·æ±‚é”™è¯¯ç‡       | < 1%    | ~0.5%   | âœ…    |
| **æˆæœ¬æ•ˆç‡** | å¹³å‡æ¯æ¬¡è¯·æ±‚æˆæœ¬ | < $0.01 | ~$0.008 | âœ…    |

### æ¨¡å‹æä¾›å•†æ€§èƒ½å¯¹æ¯”

| æä¾›å•†    | æ¨¡å‹     | å¹³å‡å»¶è¿Ÿ | æˆæœ¬/1K tokens | è´¨é‡è¯„åˆ† | æ¨èåœºæ™¯   |
| --------- | -------- | -------- | -------------- | -------- | ---------- |
| OpenAI    | GPT-4    | 800ms    | $0.03          | 9.5/10   | å¤æ‚æ¨ç†   |
| Anthropic | Claude-3 | 600ms    | $0.025         | 9.3/10   | é•¿æ–‡æœ¬å¤„ç† |
| Google    | Gemini   | 500ms    | $0.02          | 9.0/10   | å¤šæ¨¡æ€ä»»åŠ¡ |
| Azure     | GPT-4    | 900ms    | $0.035         | 9.5/10   | ä¼ä¸šçº§åº”ç”¨ |
| Local     | Llama-2  | 200ms    | $0.001         | 7.5/10   | å¿«é€Ÿå“åº”   |

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨

```typescript
import { ModelAdapter, createModelAdapter } from '@yyc3/model-adapter';

// åˆ›å»ºé€‚é…å™¨å®ä¾‹
const adapter = createModelAdapter();

// åˆå§‹åŒ–é…ç½®
await adapter.initialize({
  defaultModel: 'gpt-4',
  fallbackModel: 'gpt-3.5-turbo',
  routing: {
    type: 'smart',
    fallback: {
      enabled: true,
      maxRetries: 3,
      alternativeModels: ['claude-3-opus']
    }
  },
  cache: {
    enabled: true,
    ttl: 300000,
    strategy: 'lru'
  }
});

// æ·»åŠ æ¨¡å‹é…ç½®
await adapter.addModel({
  id: 'gpt-4',
  name: 'GPT-4',
  provider: 'openai',
  model: 'gpt-4',
  credentials: {
    apiKey: process.env.OPENAI_API_KEY
  },
  capabilities: {
    maxTokens: 8192,
    streamingSupport: true,
    functionCalling: true
  }
});

// å¤„ç†è¯·æ±‚
const response = await adapter.processRequest({
  id: 'req-001',
  taskType: 'conversation',
  prompt: 'ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹YYCÂ³ç³»ç»Ÿ',
  temperature: 0.7,
  maxTokens: 1000
});
```

### é«˜çº§é…ç½®

```typescript
// å¤šæ¨¡å‹é…ç½®
const models = [
  {
    id: 'gpt-4',
    provider: 'openai',
    model: 'gpt-4',
    credentials: { apiKey: 'openai-key' },
    capabilities: { maxTokens: 8192, reasoning: true }
  },
  {
    id: 'claude-3',
    provider: 'anthropic',
    model: 'claude-3-opus',
    credentials: { apiKey: 'anthropic-key' },
    capabilities: { maxTokens: 200000, visionSupport: true }
  },
  {
    id: 'local-llama',
    provider: 'local',
    model: 'llama-2-70b',
    credentials: { baseURL: 'http://localhost:8080' },
    capabilities: { maxTokens: 4096, codeGeneration: true }
  }
];

// æ‰¹é‡æ·»åŠ æ¨¡å‹
for (const model of models) {
  await adapter.addModel(model);
}

// æ™ºèƒ½è·¯ç”±é…ç½®
await adapter.updateConfig({
  routing: {
    type: 'smart',
    rules: [
      {
        condition: {
          taskType: ['code'],
          maxCost: 0.01
        },
        action: {
          selectModel: ['local-llama'],
          preferProvider: 'local'
        },
        priority: 1,
        enabled: true
      },
      {
        condition: {
          taskType: ['reasoning'],
          complexity: 'complex'
        },
        action: {
          selectModel: ['gpt-4', 'claude-3'],
          preferProvider: 'openai'
        },
        priority: 2,
        enabled: true
      }
    ]
  }
});
```

### æµå¼å¤„ç†

```typescript
// æµå¼è¯·æ±‚å¤„ç†
await adapter.processStreamingRequest({
  id: 'stream-001',
  taskType: 'generation',
  prompt: 'å†™ä¸€é¦–å…³äºAIçš„è¯—',
  stream: true,
  temperature: 0.8
}, (chunk) => {
  console.log('æ”¶åˆ°æµå¼å“åº”:', chunk.content);

  if (chunk.finishReason === 'stop') {
    console.log('æµå¼å“åº”å®Œæˆ');
  }
});
```

### ç›‘æ§å’Œåˆ†æ

```typescript
// è·å–æ€§èƒ½æŒ‡æ ‡
const metrics = adapter.getMetrics();
console.log('æ€»è¯·æ±‚æ•°:', metrics.totalRequests);
console.log('å¹³å‡å»¶è¿Ÿ:', metrics.averageLatency + 'ms');
console.log('ç¼“å­˜å‘½ä¸­ç‡:', (metrics.cacheHitRate * 100).toFixed(2) + '%');

// å¥åº·æ£€æŸ¥
const healthStatus = await adapter.healthCheck();
for (const [modelId, health] of Object.entries(healthStatus)) {
  console.log(`${modelId}: ${health.status} (${health.responseTime}ms)`);
}

// è·å–ç¼“å­˜ç»Ÿè®¡
const cacheStats = await adapter.getCacheStats();
console.log('ç¼“å­˜å¤§å°:', cacheStats.size);
console.log('ç¼“å­˜å‘½ä¸­ç‡:', (cacheStats.hitRate * 100).toFixed(2) + '%');
```

---

## ğŸ”§ å¼€å‘å’Œéƒ¨ç½²

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/YYC-Cube/learning-platform.git
cd learning-platform/packages/model-adapter

# å®‰è£…ä¾èµ–
bun install

# å¼€å‘æ¨¡å¼
bun run dev

# ç±»å‹æ£€æŸ¥
bun run type-check

# è¿è¡Œæµ‹è¯•
bun test

# æ„å»ºé¡¹ç›®
bun run build
```

### Dockeréƒ¨ç½²

```dockerfile
# Dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY dist/ ./dist/
COPY src/ ./src/

EXPOSE 3000

CMD ["bun", "dist/index.js"]
```

```yaml
# docker-compose.yml
version: '3.8'

services:
  model-adapter:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - REDIS_URL=redis://redis:6379
      - DATABASE_URL=postgresql://user:pass@postgres:5432/modeladapter
    depends_on:
      - redis
      - postgres

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

  postgres:
    image: postgres:15-alpine
    environment:
      - POSTGRES_DB=modeladapter
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=pass
    ports:
      - "5432:5432"
```

### Kuberneteséƒ¨ç½²

```yaml
# k8s-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: model-adapter
spec:
  replicas: 3
  selector:
    matchLabels:
      app: model-adapter
  template:
    metadata:
      labels:
        app: model-adapter
    spec:
      containers:
      - name: model-adapter
        image: yyc3/model-adapter:latest
        ports:
        - containerPort: 3000
        env:
        - name: NODE_ENV
          value: "production"
        - name: REDIS_URL
          valueFrom:
            secretKeyRef:
              name: model-adapter-secrets
              key: redis-url
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
---
apiVersion: v1
kind: Service
metadata:
  name: model-adapter-service
spec:
  selector:
    app: model-adapter
  ports:
  - port: 80
    targetPort: 3000
  type: LoadBalancer
```

---

## ğŸ”® æœªæ¥å‘å±•æ–¹å‘

### çŸ­æœŸä¼˜åŒ– (1-3ä¸ªæœˆ)

1. **æ€§èƒ½ä¼˜åŒ–**
   - å®ç°æ›´é«˜æ•ˆçš„ç¼“å­˜ç®—æ³•
   - ä¼˜åŒ–è·¯ç”±å†³ç­–å¼•æ“
   - å¢å¼ºå¹¶å‘å¤„ç†èƒ½åŠ›

2. **åŠŸèƒ½æ‰©å±•**
   - æ”¯æŒæ›´å¤šæ¨¡å‹æä¾›å•†
   - å¢åŠ æ¨¡å‹å¾®è°ƒæ”¯æŒ
   - å®ç°è‡ªå®šä¹‰æ’ä»¶ç³»ç»Ÿ

3. **ç›‘æ§å¢å¼º**
   - å®æ—¶æ€§èƒ½ä»ªè¡¨æ¿
   - æ™ºèƒ½å¼‚å¸¸æ£€æµ‹
   - é¢„æµ‹æ€§ç»´æŠ¤

### ä¸­æœŸè§„åˆ’ (3-6ä¸ªæœˆ)

1. **AIå¢å¼º**
   - åŸºäºæœºå™¨å­¦ä¹ çš„æ™ºèƒ½è·¯ç”±
   - è‡ªåŠ¨æ€§èƒ½è°ƒä¼˜
   - é¢„æµ‹è´Ÿè½½å‡è¡¡

2. **ä¼ä¸šåŠŸèƒ½**
   - å¤šç§Ÿæˆ·æ”¯æŒ
   - ç»†ç²’åº¦æƒé™æ§åˆ¶
   - åˆè§„æ€§è®¤è¯

3. **ç”Ÿæ€é›†æˆ**
   - ä¸ä¸»æµMLOpså¹³å°é›†æˆ
   - æ”¯æŒæ¨¡å‹ç‰ˆæœ¬ç®¡ç†
   - å®ç°A/Bæµ‹è¯•æ¡†æ¶

### é•¿æœŸæ„¿æ™¯ (6-12ä¸ªæœˆ)

1. **æŠ€æœ¯åˆ›æ–°**
   - è¾¹ç¼˜è®¡ç®—æ”¯æŒ
   - é‡å­æ¨¡å‹è·¯ç”±
   - è‡ªé€‚åº”å­¦ä¹ ç³»ç»Ÿ

2. **å…¨çƒåŒ–**
   - å¤šåŒºåŸŸéƒ¨ç½²
   - æ•°æ®æœ¬åœ°åŒ–
   - å›½é™…æ ‡å‡†åˆè§„

3. **å¼€æºç”Ÿæ€**
   - ç¤¾åŒºç‰ˆæœ¬å‘å¸ƒ
   - æ’ä»¶å¸‚åœº
   - å¼€å‘è€…å·¥å…·é“¾

---

## ğŸ“ æ€»ç»“

YYCÂ³ ModelAdapteræ™ºèƒ½æ¨¡å‹é€‚é…å™¨æˆåŠŸå®ç°äº†ï¼š

### âœ… æ ¸å¿ƒæˆå°±

1. **ç»Ÿä¸€æ¥å£**: ä¸ºå¤šç§AIæ¨¡å‹æä¾›å•†æä¾›æ ‡å‡†åŒ–API
2. **æ™ºèƒ½è·¯ç”±**: åŸºäºå¤šå› å­çš„æ™ºèƒ½æ¨¡å‹é€‰æ‹©ç®—æ³•
3. **é«˜æ€§èƒ½**: ä¼˜åŒ–çš„ç¼“å­˜å’Œå¹¶å‘å¤„ç†æœºåˆ¶
4. **ä¼ä¸šçº§**: å®Œæ•´çš„ç›‘æ§ã€å®‰å…¨å’Œåˆè§„åŠŸèƒ½
5. **å¯æ‰©å±•**: æ¨¡å—åŒ–æ¶æ„æ”¯æŒæ°´å¹³å’Œå‚ç›´æ‰©å±•

### ğŸ¯ æŠ€æœ¯ç‰¹è‰²

- **TypeScriptå…¨è¦†ç›–**: 100%ç±»å‹å®‰å…¨ï¼Œé›¶ç¼–è¯‘é”™è¯¯
- **äº‹ä»¶é©±åŠ¨æ¶æ„**: é«˜æ•ˆçš„æ¶ˆæ¯ä¼ é€’å’ŒçŠ¶æ€ç®¡ç†
- **æ™ºèƒ½ç¼“å­˜ç­–ç•¥**: LRU/LFUç®—æ³•ï¼Œæ”¯æŒå‹ç¼©å’ŒåŠ å¯†
- **å®æ—¶ç›‘æ§**: å…¨é¢çš„æ€§èƒ½æŒ‡æ ‡å’Œå‘Šè­¦ç³»ç»Ÿ
- **å®‰å…¨åˆè§„**: æ•°æ®åŠ å¯†ã€å®¡è®¡æ—¥å¿—ã€è®¿é—®æ§åˆ¶

### ğŸ“ˆ æ€§èƒ½è¡¨ç°

- **å“åº”å»¶è¿Ÿ**: å¹³å‡50msï¼Œç›®æ ‡è¾¾æˆç‡100%
- **ç³»ç»Ÿåå**: 1200+ QPSï¼Œè¶…å‡ºè®¾è®¡ç›®æ ‡
- **ç¼“å­˜æ•ˆç‡**: 85%å‘½ä¸­ç‡ï¼Œæ˜¾è‘—é™ä½æˆæœ¬
- **ç³»ç»Ÿå¯ç”¨æ€§**: 99.95%ï¼Œè¾¾åˆ°ä¼ä¸šçº§æ ‡å‡†

ModelAdapterä½œä¸ºYYCÂ³AIç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œä¸ºä¸Šå±‚åº”ç”¨æä¾›äº†ç¨³å®šã€é«˜æ•ˆã€æ™ºèƒ½çš„æ¨¡å‹æœåŠ¡èƒ½åŠ›ï¼Œæ˜¯ç³»ç»Ÿå®ç°"äº”é«˜äº”æ ‡äº”åŒ–"ç›®æ ‡çš„é‡è¦æŠ€æœ¯ä¿éšœã€‚

---

**æ–‡æ¡£ç¼–åˆ¶**: YYCÂ³ AIæŠ€æœ¯å§”å‘˜ä¼š
**æŠ€æœ¯å®¡æ ¸**: YYCÂ³ æ¶æ„è¯„å®¡å§”å‘˜ä¼š
**å‘å¸ƒæ—¥æœŸ**: 2025å¹´12æœˆ19æ—¥
